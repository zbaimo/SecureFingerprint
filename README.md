# ğŸ›¡ï¸ é˜²ç«å¢™æ§åˆ¶å™¨ (Firewall Controller)

ä¸€ä¸ªåŸºäºç”¨æˆ·æŒ‡çº¹çš„æ™ºèƒ½è®¿é—®æ§åˆ¶ç³»ç»Ÿï¼Œæä¾›å®æ—¶è¡Œä¸ºåˆ†æã€é£é™©è¯„ä¼°å’Œè‡ªåŠ¨é˜²æŠ¤åŠŸèƒ½ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ¯ æ™ºèƒ½è¯†åˆ«
- **ç”¨æˆ·æŒ‡çº¹ç”Ÿæˆ**: åŸºäºIPã€User-Agentã€HTTPå¤´ç­‰ä¿¡æ¯ç”Ÿæˆç¨³å®šçš„ç”¨æˆ·æ ‡è¯†
- **è®¾å¤‡ç±»å‹æ£€æµ‹**: è‡ªåŠ¨è¯†åˆ«ç§»åŠ¨è®¾å¤‡ã€æ¡Œé¢æµè§ˆå™¨ã€æœºå™¨äººç­‰
- **ç½‘ç»œç±»å‹åˆ†æ**: åŒºåˆ†å†…ç½‘ã€ä»£ç†ã€ç§»åŠ¨ç½‘ç»œç­‰è®¿é—®æ¥æº

### ğŸ“Š è¡Œä¸ºåˆ†æ
- **è®¿é—®æ¨¡å¼è¯†åˆ«**: æ£€æµ‹å¼‚å¸¸è®¿é—®é¢‘ç‡ã€è·¯å¾„æ¨¡å¼ã€æ—¶é—´åˆ†å¸ƒ
- **æœºå™¨äººæ£€æµ‹**: å¤šç»´åº¦è¯†åˆ«çˆ¬è™«ã€æ‰«æå™¨ç­‰è‡ªåŠ¨åŒ–å·¥å…·
- **é£é™©è¯„ä¼°**: å®æ—¶è®¡ç®—ç”¨æˆ·é£é™©ç­‰çº§ï¼Œæ”¯æŒè‡ªå®šä¹‰è¯„åˆ†è§„åˆ™

### ğŸ”’ è®¿é—®æ§åˆ¶
- **å¤šå±‚é˜²æŠ¤**: æ”¯æŒé™é€Ÿã€äººæœºéªŒè¯ã€ä¸´æ—¶å°ç¦ç­‰å¤šç§å¤„ç†æ–¹å¼
- **åŠ¨æ€è°ƒæ•´**: æ ¹æ®ç”¨æˆ·è¡Œä¸ºåŠ¨æ€è°ƒæ•´è®¿é—®æƒé™
- **ç™½åå•æœºåˆ¶**: æ”¯æŒå¯ä¿¡ç”¨æˆ·ç™½åå•ï¼Œé¿å…è¯¯æ€

### ğŸ“ˆ å¯è§†åŒ–ç®¡ç†
- **å®æ—¶ç›‘æ§**: ç›´è§‚çš„ä»ªè¡¨æ¿æ˜¾ç¤ºç³»ç»Ÿè¿è¡ŒçŠ¶æ€
- **æ—¥å¿—åˆ†æ**: è¯¦ç»†çš„è®¿é—®æ—¥å¿—å’Œç»Ÿè®¡åˆ†æ
- **é…ç½®ç®¡ç†**: çµæ´»çš„è§„åˆ™é…ç½®å’Œå‚æ•°è°ƒä¼˜

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Web Client    â”‚    â”‚   Mobile App    â”‚    â”‚   API Client    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                      â”‚                      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         Nginx               â”‚
                    â”‚    (Reverse Proxy)          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    Firewall Controller      â”‚
                    â”‚                             â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                    â”‚  â”‚Collectorâ”‚ â”‚Analyzer â”‚   â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                    â”‚  â”‚ Scorer  â”‚ â”‚ Limiter â”‚   â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚        Storage              â”‚
                    â”‚                             â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                    â”‚  â”‚  Redis  â”‚ â”‚  MySQL  â”‚   â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Docker & Docker Compose
- Go 1.21+ (å¼€å‘ç¯å¢ƒ)
- Node.js 18+ (å‰ç«¯å¼€å‘)

### ä¸€é”®éƒ¨ç½²

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/your-org/firewall-controller.git
cd firewall-controller

# å¯åŠ¨å®Œæ•´ç¯å¢ƒ
make up

# è®¿é—®ç³»ç»Ÿ
open http://localhost
```

### å¼€å‘ç¯å¢ƒ

```bash
# å®‰è£…å¼€å‘å·¥å…·
make install-tools

# å¯åŠ¨åŸºç¡€æœåŠ¡
make dev-up

# å¼€å‘æ¨¡å¼è¿è¡Œ
make dev
```

## ğŸ“– ä½¿ç”¨æŒ‡å—

### ç³»ç»Ÿé…ç½®

ä¸»è¦é…ç½®æ–‡ä»¶ä½äº `configs/config.yaml`ï¼š

```yaml
security:
  scoring:
    initial_score: 100        # åˆå§‹åˆ†æ•°
    ban_threshold: 0          # å°ç¦é˜ˆå€¼
    bot_penalty: -15          # æœºå™¨äººæ‰£åˆ†
  
  limiter:
    max_requests_per_window: 100  # çª—å£æœ€å¤§è¯·æ±‚æ•°
    ban_duration: 3600s          # å°ç¦æ—¶é•¿
  
  analyzer:
    suspicious_request_threshold: 50  # å¯ç–‘è¯·æ±‚é˜ˆå€¼
    bot_detection_enabled: true       # å¯ç”¨æœºå™¨äººæ£€æµ‹
```

### APIæ¥å£

ç³»ç»Ÿæä¾›å®Œæ•´çš„REST APIï¼š

- **ç³»ç»Ÿä¿¡æ¯**: `GET /api/v1/system/info`
- **è®¿é—®æ—¥å¿—**: `GET /api/v1/logs`
- **ç”¨æˆ·åˆ†æ•°**: `GET /api/v1/score/{fingerprint}`
- **é£æ§è§„åˆ™**: `GET /api/v1/rule/ban`

è¯¦ç»†APIæ–‡æ¡£è¯·æŸ¥çœ‹ [APIæ–‡æ¡£](docs/api.md)

### é›†æˆæŒ‡å—

#### ä¸­é—´ä»¶é›†æˆ

```go
import "firewall-controller/pkg/middleware"

// Ginæ¡†æ¶
router.Use(middleware.FirewallMiddleware())

// åŸç”ŸHTTP
http.Handle("/", middleware.FirewallHandler(yourHandler))
```

#### è‡ªå®šä¹‰è§„åˆ™

```go
// è‡ªå®šä¹‰è¯„åˆ†è§„åˆ™
scorer.AddRule("custom", func(info *AccessInfo) int {
    if strings.Contains(info.Path, "/admin") {
        return -10
    }
    return 0
})
```

## ğŸ”§ é…ç½®è¯´æ˜

### è¯„åˆ†ç³»ç»Ÿ

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `initial_score` | 100 | æ–°ç”¨æˆ·åˆå§‹åˆ†æ•° |
| `normal_access_bonus` | +1 | æ­£å¸¸è®¿é—®åŠ åˆ† |
| `bot_penalty` | -15 | æœºå™¨äººè¡Œä¸ºæ‰£åˆ† |
| `frequent_request_penalty` | -10 | é¢‘ç¹è¯·æ±‚æ‰£åˆ† |

### é™åˆ¶å™¨é…ç½®

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `rate_limit_window` | 60s | é™é€Ÿæ—¶é—´çª—å£ |
| `max_requests_per_window` | 100 | çª—å£æœ€å¤§è¯·æ±‚æ•° |
| `ban_duration` | 3600s | å°ç¦æŒç»­æ—¶é—´ |

### è¡Œä¸ºåˆ†æ

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `suspicious_request_threshold` | 50 | å¯ç–‘è¯·æ±‚é˜ˆå€¼ |
| `path_repeat_threshold` | 10 | è·¯å¾„é‡å¤è®¿é—®é˜ˆå€¼ |
| `bot_detection_enabled` | true | å¯ç”¨æœºå™¨äººæ£€æµ‹ |

## ğŸ“Š ç›‘æ§æŒ‡æ ‡

ç³»ç»Ÿæä¾›ä¸°å¯Œçš„ç›‘æ§æŒ‡æ ‡ï¼š

- **è¯·æ±‚ç»Ÿè®¡**: æ€»è¯·æ±‚æ•°ã€æˆåŠŸç‡ã€é”™è¯¯ç‡
- **ç”¨æˆ·åˆ†æ**: æ´»è·ƒç”¨æˆ·æ•°ã€æ–°ç”¨æˆ·æ•°ã€é£é™©ç”¨æˆ·æ•°
- **å®‰å…¨äº‹ä»¶**: å°ç¦æ•°ã€æ‹¦æˆªæ•°ã€è¯¯æŠ¥ç‡
- **æ€§èƒ½æŒ‡æ ‡**: å“åº”æ—¶é—´ã€ååé‡ã€èµ„æºä½¿ç”¨ç‡

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
firewall-controller/
â”œâ”€â”€ cmd/server/          # ç¨‹åºå…¥å£
â”œâ”€â”€ internal/            # å†…éƒ¨æ ¸å¿ƒé€»è¾‘
â”‚   â”œâ”€â”€ collector/       # æ•°æ®é‡‡é›†
â”‚   â”œâ”€â”€ fingerprint/     # æŒ‡çº¹ç”Ÿæˆ
â”‚   â”œâ”€â”€ scorer/          # æ‰“åˆ†ç³»ç»Ÿ
â”‚   â”œâ”€â”€ analyzer/        # è¡Œä¸ºåˆ†æ
â”‚   â”œâ”€â”€ limiter/         # è®¿é—®é™åˆ¶
â”‚   â””â”€â”€ storage/         # æ•°æ®å­˜å‚¨
â”œâ”€â”€ api/                 # WebUIæ¥å£
â”œâ”€â”€ webui/               # Vue3å‰ç«¯
â”œâ”€â”€ pkg/                 # å…¬å…±åº“
â”œâ”€â”€ configs/             # é…ç½®æ–‡ä»¶
â”œâ”€â”€ docker/              # Dockeré…ç½®
â””â”€â”€ docs/                # æ–‡æ¡£
```

### å¼€å‘æµç¨‹

```bash
# 1. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/new-feature

# 2. å¼€å‘å’Œæµ‹è¯•
make dev
make test

# 3. ä»£ç æ£€æŸ¥
make lint
make security

# 4. æäº¤ä»£ç 
git commit -m "feat: add new feature"
git push origin feature/new-feature
```

### æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
make test

# æŸ¥çœ‹è¦†ç›–ç‡
make coverage

# æ€§èƒ½æµ‹è¯•
make bench
```

## ğŸ³ Dockeréƒ¨ç½²

### å•æœºéƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
make docker-build

# å¯åŠ¨æœåŠ¡
docker-compose up -d
```

### é›†ç¾¤éƒ¨ç½²

æ”¯æŒKuberneteséƒ¨ç½²ï¼Œé…ç½®æ–‡ä»¶ä½äº `k8s/` ç›®å½•ï¼š

```bash
kubectl apply -f k8s/
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### ç³»ç»Ÿè°ƒä¼˜

1. **Redisé…ç½®**
   - åˆç†è®¾ç½®å†…å­˜é™åˆ¶
   - å¯ç”¨æŒä¹…åŒ–
   - é…ç½®é›†ç¾¤æ¨¡å¼

2. **MySQLä¼˜åŒ–**
   - ç´¢å¼•ä¼˜åŒ–
   - æŸ¥è¯¢ç¼“å­˜
   - è¯»å†™åˆ†ç¦»

3. **åº”ç”¨å±‚ä¼˜åŒ–**
   - è¿æ¥æ± é…ç½®
   - ç¼“å­˜ç­–ç•¥
   - å¼‚æ­¥å¤„ç†

### æ‰©å®¹æ–¹æ¡ˆ

- **æ°´å¹³æ‰©å±•**: æ”¯æŒå¤šå®ä¾‹éƒ¨ç½²
- **ç¼“å­˜åˆ†å±‚**: Redis + æœ¬åœ°ç¼“å­˜
- **æ•°æ®åº“åˆ†ç‰‡**: æŒ‰æ—¶é—´æˆ–ç”¨æˆ·åˆ†ç‰‡

## ğŸ” å®‰å…¨è€ƒè™‘

### æ•°æ®ä¿æŠ¤

- ç”¨æˆ·æŒ‡çº¹é‡‡ç”¨å“ˆå¸ŒåŠ ç›
- æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
- è®¿é—®æ—¥å¿—å®šæœŸæ¸…ç†

### è®¿é—®æ§åˆ¶

- APIæ¥å£é‰´æƒ
- ç®¡ç†åå°æƒé™æ§åˆ¶
- æ“ä½œå®¡è®¡æ—¥å¿—

### é˜²æŠ¤æœºåˆ¶

- é˜²æ­¢é…ç½®ç¯¡æ”¹
- é™åˆ¶ç®¡ç†æ¥å£è®¿é—®
- å¼‚å¸¸è¡Œä¸ºå‘Šè­¦

## ğŸ“š æ–‡æ¡£

- [å®‰è£…æŒ‡å—](docs/installation.md)
- [é…ç½®å‚è€ƒ](docs/configuration.md)
- [APIæ–‡æ¡£](docs/api.md)
- [å¼€å‘æŒ‡å—](docs/development.md)
- [éƒ¨ç½²æŒ‡å—](docs/deployment.md)
- [æ•…éšœæ’æŸ¥](docs/troubleshooting.md)

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

1. Forké¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»ºPull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MITè®¸å¯è¯](LICENSE)

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…å’Œå¼€æºé¡¹ç›®çš„æ”¯æŒï¼

---

<div align="center">
  <p>å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª â­ï¸ æ”¯æŒä¸€ä¸‹ï¼</p>
</div>
